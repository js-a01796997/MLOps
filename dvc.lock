schema: '2.0'
stages:
  preprocess:
    cmd: uv run src/data_cleaning.py
    deps:
    - path: data/raw/bike_sharing_modified.csv
      hash: md5
      md5: 1484028223d304a18ddd9ce33a1af441
      size: 1686247
    - path: src/data_cleaning.py
      hash: md5
      md5: 7926d0c095b8ed377c73b8916159b989
      size: 19472
    outs:
    - path: data/processed/bike_sharing_cleaned.csv
      hash: md5
      md5: 63f41ae535d8b00f4cc94068540047bb
      size: 1155905
  split_data:
    cmd: uv run src/data_split.py
    deps:
    - path: data/processed/bike_sharing_cleaned.csv
      hash: md5
      md5: 63f41ae535d8b00f4cc94068540047bb
      size: 1155905
    - path: src/data_split.py
      hash: md5
      md5: 026bf5a15c98941071f6e7f2a95a475d
      size: 9244
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: 5da82bbd9ffda938af6d8f895e3e7b8d
      size: 555981
    - path: data/processed/train.csv
      hash: md5
      md5: 1f0e8af20b973a06aa9952ab40954b7e
      size: 2595876
    - path: data/processed/valid.csv
      hash: md5
      md5: 3f73cb772ee2da74c2fa5ca15406d4d9
      size: 556614
  train:
    cmd: uv run src/train_models.py config/models_config.yaml
    deps:
    - path: config/models_config.yaml
      hash: md5
      md5: 2717f794282ac010dd9a455b0a99b6ff
      size: 3149
    - path: data/processed/test.csv
      hash: md5
      md5: 5da82bbd9ffda938af6d8f895e3e7b8d
      size: 555981
    - path: data/processed/train.csv
      hash: md5
      md5: 1f0e8af20b973a06aa9952ab40954b7e
      size: 2595876
    - path: data/processed/valid.csv
      hash: md5
      md5: 3f73cb772ee2da74c2fa5ca15406d4d9
      size: 556614
    - path: src/train_models.py
      hash: md5
      md5: e1adbe74787f52c1cdc53cd918382edf
      size: 13174
    params:
      config/models_config.yaml:
        mlflow.experiment_name: bike_sharing_demand
        models:
          linear_regression:
            enabled: true
            class: LinearRegression
            module: sklearn.linear_model
            search_method: grid
            param_grid:
              fit_intercept:
              - true
              - false
              copy_X:
              - true
            cv_folds: 5
          ridge_regression:
            enabled: true
            class: Ridge
            module: sklearn.linear_model
            search_method: random
            n_iter: 20
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              - 100.0
              - 1000.0
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
              - 10000
            cv_folds: 5
          lasso_regression:
            enabled: true
            class: Lasso
            module: sklearn.linear_model
            search_method: random
            n_iter: 20
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              - 100.0
              - 1000.0
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
              - 10000
            cv_folds: 5
          elasticnet:
            enabled: true
            class: ElasticNet
            module: sklearn.linear_model
            search_method: random
            n_iter: 30
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              l1_ratio:
              - 0.1
              - 0.3
              - 0.5
              - 0.7
              - 0.9
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
            cv_folds: 5
            xgboost:
              enabled: true
              module: xgboost
              class: XGBRegressor
              param_grid:
                n_estimators:
                - 100
                - 200
                max_depth:
                - 3
                - 5
                - 7
                - 9
                learning_rate:
                - 0.01
                - 0.1
                - 0.3
                subsample:
                - 0.8
                - 0.9
                - 1.0
                colsample_bytree:
                - 0.6
                - 0.7
                - 0.8
                gamma:
                - 0
                - 0.1
                - 0.2
                min_child_weight:
                - 1
                - 3
                - 5
              cv_folds: 3
              search_method: randomized
              n_iter: 10
          random_forest:
            enabled: false
            class: RandomForestRegressor
            module: sklearn.ensemble
            param_grid:
              n_estimators:
              - 50
              - 100
              - 200
              max_depth:
              - 10
              - 20
              - 30
              - 
              min_samples_split:
              - 2
              - 5
              - 10
              min_samples_leaf:
              - 1
              - 2
              - 4
            cv_folds: 3
          gradient_boosting:
            enabled: false
            class: GradientBoostingRegressor
            module: sklearn.ensemble
            param_grid:
              n_estimators:
              - 100
              - 200
              learning_rate:
              - 0.01
              - 0.1
              - 0.2
              max_depth:
              - 3
              - 5
              - 7
              subsample:
              - 0.8
              - 1.0
            cv_folds: 3
          xgboost:
            enabled: true
            class: XGBRegressor
            module: xgboost
            search_method: random
            n_iter: 30
            param_grid:
              n_estimators:
              - 100
              - 200
              - 500
              - 1000
              learning_rate:
              - 0.01
              - 0.05
              - 0.1
              - 0.2
              max_depth:
              - 3
              - 5
              - 7
              - 9
              min_child_weight:
              - 1
              - 3
              - 5
              gamma:
              - 0
              - 0.1
              - 0.2
              subsample:
              - 0.7
              - 0.8
              - 0.9
              - 1.0
              colsample_bytree:
              - 0.6
              - 0.7
              - 0.8
              - 0.9
              verbosity:
              - 0
              random_state:
              - 42
            cv_folds: 3
    outs:
    - path: models/model_comparison.csv
      hash: md5
      md5: 98e6b76719f579a0fe201ae43b8bcc7d
      size: 1050
    - path: models/modelo_elasticnet.pickle
      hash: md5
      md5: 81b84a94221a45d9dcfe6301531f9190
      size: 1177
    - path: models/modelo_lasso_regression.pickle
      hash: md5
      md5: 05e3953f2f49bbb14c824c2d864cbc13
      size: 1162
    - path: models/modelo_linear_regression.pickle
      hash: md5
      md5: fa09311672d1b399d2c21926604b6f4c
      size: 1320
    - path: models/modelo_ridge_regression.pickle
      hash: md5
      md5: e2c1b8ff7d34537bb1bb99aefdee50ff
      size: 1095
    - path: models/modelo_xgboost.pickle
      hash: md5
      md5: 71bc05c5791b1fe25b3212e8a9dd9b02
      size: 3527111
  test:
    cmd: uv run pytest tests/ -v
    deps:
    - path: src/data_cleaning.py
      hash: md5
      md5: 7926d0c095b8ed377c73b8916159b989
      size: 19472
    - path: tests/test_data_cleaning.py
      hash: md5
      md5: 21b86790cc5f1bce429487c170ec08fb
      size: 8255
