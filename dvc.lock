schema: '2.0'
stages:
  preprocess:
    cmd: uv run src/data_cleaning.py
    deps:
    - path: data/raw/bike_sharing_modified.csv
      hash: md5
      md5: 1484028223d304a18ddd9ce33a1af441
      size: 1686247
    - path: src/data_cleaning.py
      hash: md5
      md5: e83c4aaddea6d87dcc4df7a8bffd8e0b
      size: 18961
    outs:
    - path: data/processed/bike_sharing_cleaned.csv
      hash: md5
      md5: aba16c5849dd5c5680fe5c43d963c2ce
      size: 1138549
  split_data:
    cmd: uv run src/data_split.py
    deps:
    - path: data/processed/bike_sharing_cleaned.csv
      hash: md5
      md5: aba16c5849dd5c5680fe5c43d963c2ce
      size: 1138549
    - path: src/data_split.py
      hash: md5
      md5: 695f6f1abbc55a0bbe543fc5eee00c58
      size: 8958
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: 298b7cea71f3ca26b2d618066507ab15
      size: 553376
    - path: data/processed/train.csv
      hash: md5
      md5: 41dfaf2a656981a32421d8491074d451
      size: 2583727
    - path: data/processed/valid.csv
      hash: md5
      md5: b0ac1f4d342bc896ce5b23f09528292d
      size: 554010
  train:
    cmd: uv run src/train_models.py config/models_config.yaml
    deps:
    - path: config/models_config.yaml
      hash: md5
      md5: fb6d0679bfc84c34e4982de20ed0dbbc
      size: 3562
    - path: data/processed/test.csv
      hash: md5
      md5: 298b7cea71f3ca26b2d618066507ab15
      size: 553376
    - path: data/processed/train.csv
      hash: md5
      md5: 41dfaf2a656981a32421d8491074d451
      size: 2583727
    - path: data/processed/valid.csv
      hash: md5
      md5: b0ac1f4d342bc896ce5b23f09528292d
      size: 554010
    - path: src/train_models.py
      hash: md5
      md5: 0dded8ceccef0f607601b28cc7bd8c89
      size: 18573
    params:
      config/models_config.yaml:
        mlflow.experiment_name: bike_sharing_demand
        models:
          linear_regression:
            enabled: true
            class: LinearRegression
            module: sklearn.linear_model
            search_method: grid
            param_grid:
              fit_intercept:
              - true
              - false
              copy_X:
              - true
            cv_folds: 5
          ridge_regression:
            enabled: true
            class: Ridge
            module: sklearn.linear_model
            search_method: random
            n_iter: 20
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              - 100.0
              - 1000.0
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
              - 10000
            cv_folds: 5
          lasso_regression:
            enabled: true
            class: Lasso
            module: sklearn.linear_model
            search_method: random
            n_iter: 20
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              - 100.0
              - 1000.0
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
              - 10000
            cv_folds: 5
          elasticnet:
            enabled: true
            class: ElasticNet
            module: sklearn.linear_model
            search_method: random
            n_iter: 30
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              l1_ratio:
              - 0.1
              - 0.3
              - 0.5
              - 0.7
              - 0.9
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
            cv_folds: 5
            xgboost:
              enabled: true
              module: xgboost
              class: XGBRegressor
              param_grid:
                n_estimators:
                - 100
                - 200
                max_depth:
                - 3
                - 5
                - 7
                - 9
                learning_rate:
                - 0.01
                - 0.1
                - 0.3
                subsample:
                - 0.8
                - 0.9
                - 1.0
                colsample_bytree:
                - 0.6
                - 0.7
                - 0.8
                gamma:
                - 0
                - 0.1
                - 0.2
                min_child_weight:
                - 1
                - 3
                - 5
              cv_folds: 3
              search_method: randomized
              n_iter: 10
          random_forest:
            enabled: false
            class: RandomForestRegressor
            module: sklearn.ensemble
            param_grid:
              n_estimators:
              - 50
              - 100
              - 200
              max_depth:
              - 10
              - 20
              - 30
              - 
              min_samples_split:
              - 2
              - 5
              - 10
              min_samples_leaf:
              - 1
              - 2
              - 4
            cv_folds: 3
          gradient_boosting:
            enabled: false
            class: GradientBoostingRegressor
            module: sklearn.ensemble
            param_grid:
              n_estimators:
              - 100
              - 200
              learning_rate:
              - 0.01
              - 0.1
              - 0.2
              max_depth:
              - 3
              - 5
              - 7
              subsample:
              - 0.8
              - 1.0
            cv_folds: 3
          xgboost:
            enabled: true
            class: XGBRegressor
            module: xgboost
            search_method: random
            n_iter: 30
            param_grid:
              n_estimators:
              - 100
              - 200
              - 500
              - 1000
              learning_rate:
              - 0.01
              - 0.05
              - 0.1
              - 0.2
              max_depth:
              - 3
              - 5
              - 7
              - 9
              min_child_weight:
              - 1
              - 3
              - 5
              gamma:
              - 0
              - 0.1
              - 0.2
              subsample:
              - 0.7
              - 0.8
              - 0.9
              - 1.0
              colsample_bytree:
              - 0.6
              - 0.7
              - 0.8
              - 0.9
              verbosity:
              - 0
              random_state:
              - 42
            cv_folds: 3
    outs:
    - path: models/model_comparison.csv
      hash: md5
      md5: 9558edc5b8a7e1ea65f0804085d9a99a
      size: 1055
    - path: models/modelo_elasticnet.pickle
      hash: md5
      md5: a3a3052ee34d39cf3e03056c3d9f460c
      size: 1178
    - path: models/modelo_lasso_regression.pickle
      hash: md5
      md5: e27889a4ee639014ab4ac7acca5b7321
      size: 1163
    - path: models/modelo_linear_regression.pickle
      hash: md5
      md5: 701805db5ffe15b762fda280f53e5186
      size: 1320
    - path: models/modelo_ridge_regression.pickle
      hash: md5
      md5: 62917f6635b649822056fb73c1c043fd
      size: 1096
    - path: models/modelo_xgboost.pickle
      hash: md5
      md5: f8fe449d3e372b6f49e82c9287e99f47
      size: 3590555
  test:
    cmd: uv run pytest tests/ -v
    deps:
    - path: src/data_cleaning.py
      hash: md5
      md5: e83c4aaddea6d87dcc4df7a8bffd8e0b
      size: 18961
    - path: tests/test_data_cleaning.py
      hash: md5
      md5: f78ea69cb97eb1da37be58071296d356
      size: 8028
