schema: '2.0'
stages:
  preprocess:
    cmd: uv run src/data_cleaning.py
    deps:
    - path: data/raw/bike_sharing_modified.csv
      hash: md5
      md5: 1484028223d304a18ddd9ce33a1af441
      size: 1686247
    - path: src/data_cleaning.py
      hash: md5
      md5: 7926d0c095b8ed377c73b8916159b989
      size: 19472
    outs:
    - path: data/processed/bike_sharing_cleaned.csv
      hash: md5
      md5: 63f41ae535d8b00f4cc94068540047bb
      size: 1155905
  split_data:
    cmd: uv run src/data_split.py
    deps:
    - path: data/processed/bike_sharing_cleaned.csv
      hash: md5
      md5: 63f41ae535d8b00f4cc94068540047bb
      size: 1155905
    - path: src/data_split.py
      hash: md5
      md5: 026bf5a15c98941071f6e7f2a95a475d
      size: 9244
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: 5da82bbd9ffda938af6d8f895e3e7b8d
      size: 555981
    - path: data/processed/train.csv
      hash: md5
      md5: 1f0e8af20b973a06aa9952ab40954b7e
      size: 2595876
    - path: data/processed/valid.csv
      hash: md5
      md5: 3f73cb772ee2da74c2fa5ca15406d4d9
      size: 556614
  train:
    cmd: uv run src/train_models.py config/models_config.yaml
    deps:
    - path: config/models_config.yaml
      hash: md5
      md5: 71ee86d16f6b5b21f696db72706e906c
      size: 3694
    - path: data/processed/test.csv
      hash: md5
      md5: 5da82bbd9ffda938af6d8f895e3e7b8d
      size: 555981
    - path: data/processed/train.csv
      hash: md5
      md5: 1f0e8af20b973a06aa9952ab40954b7e
      size: 2595876
    - path: data/processed/valid.csv
      hash: md5
      md5: 3f73cb772ee2da74c2fa5ca15406d4d9
      size: 556614
    - path: src/train_models.py
      hash: md5
      md5: 37b2ecbb60015a84a47e6310de6753e2
      size: 19056
    params:
      config/models_config.yaml:
        mlflow.experiment_name: bike_sharing_demand
        models:
          linear_regression:
            enabled: true
            class: LinearRegression
            module: sklearn.linear_model
            search_method: grid
            param_grid:
              fit_intercept:
              - true
              - false
              copy_X:
              - true
            cv_folds: 5
          ridge_regression:
            enabled: true
            class: Ridge
            module: sklearn.linear_model
            search_method: random
            n_iter: 20
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              - 100.0
              - 1000.0
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
              - 10000
            cv_folds: 5
          lasso_regression:
            enabled: true
            class: Lasso
            module: sklearn.linear_model
            search_method: random
            n_iter: 20
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              - 100.0
              - 1000.0
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
              - 10000
            cv_folds: 5
          elasticnet:
            enabled: true
            class: ElasticNet
            module: sklearn.linear_model
            search_method: random
            n_iter: 30
            param_grid:
              alpha:
              - 0.001
              - 0.01
              - 0.1
              - 1.0
              - 10.0
              l1_ratio:
              - 0.1
              - 0.3
              - 0.5
              - 0.7
              - 0.9
              fit_intercept:
              - true
              - false
              max_iter:
              - 1000
              - 5000
            cv_folds: 5
            xgboost:
              enabled: true
              module: xgboost
              class: XGBRegressor
              param_grid:
                n_estimators:
                - 100
                - 200
                max_depth:
                - 3
                - 5
                - 7
                - 9
                learning_rate:
                - 0.01
                - 0.1
                - 0.3
                subsample:
                - 0.8
                - 0.9
                - 1.0
                colsample_bytree:
                - 0.6
                - 0.7
                - 0.8
                gamma:
                - 0
                - 0.1
                - 0.2
                min_child_weight:
                - 1
                - 3
                - 5
              cv_folds: 3
              search_method: randomized
              n_iter: 10
          random_forest:
            enabled: false
            class: RandomForestRegressor
            module: sklearn.ensemble
            param_grid:
              n_estimators:
              - 50
              - 100
              - 200
              max_depth:
              - 10
              - 20
              - 30
              - 
              min_samples_split:
              - 2
              - 5
              - 10
              min_samples_leaf:
              - 1
              - 2
              - 4
            cv_folds: 3
          gradient_boosting:
            enabled: false
            class: GradientBoostingRegressor
            module: sklearn.ensemble
            param_grid:
              n_estimators:
              - 100
              - 200
              learning_rate:
              - 0.01
              - 0.1
              - 0.2
              max_depth:
              - 3
              - 5
              - 7
              subsample:
              - 0.8
              - 1.0
            cv_folds: 3
          xgboost:
            enabled: true
            class: XGBRegressor
            module: xgboost
            search_method: random
            n_iter: 30
            param_grid:
              n_estimators:
              - 100
              - 200
              - 500
              - 1000
              learning_rate:
              - 0.01
              - 0.05
              - 0.1
              - 0.2
              max_depth:
              - 3
              - 5
              - 7
              - 9
              min_child_weight:
              - 1
              - 3
              - 5
              gamma:
              - 0
              - 0.1
              - 0.2
              subsample:
              - 0.7
              - 0.8
              - 0.9
              - 1.0
              colsample_bytree:
              - 0.6
              - 0.7
              - 0.8
              - 0.9
              verbosity:
              - 0
              random_state:
              - 42
            cv_folds: 3
    outs:
    - path: models/model_comparison.csv
      hash: md5
      md5: 16483dc3904111f8f92ed0c8e4ce02a4
      size: 1060
    - path: models/modelo_elasticnet.pickle
      hash: md5
      md5: f996d5d2ed3ce6d772c315852faef655
      size: 1178
    - path: models/modelo_lasso_regression.pickle
      hash: md5
      md5: cf337e38e8ed19df56ad499f33f3dcf9
      size: 1163
    - path: models/modelo_linear_regression.pickle
      hash: md5
      md5: 3eb45e651ced13c2fe850cc2d7073409
      size: 1320
    - path: models/modelo_ridge_regression.pickle
      hash: md5
      md5: 593ef7b8983b293a3ec15946d60cde91
      size: 1096
    - path: models/modelo_xgboost.pickle
      hash: md5
      md5: 1b5e42f0f899808300800809f884e7c1
      size: 3508275
  test:
    cmd: uv run pytest tests/ -v
    deps:
    - path: src/data_cleaning.py
      hash: md5
      md5: 7926d0c095b8ed377c73b8916159b989
      size: 19472
    - path: tests/test_data_cleaning.py
      hash: md5
      md5: 21b86790cc5f1bce429487c170ec08fb
      size: 8255
